{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>reprogramar cita</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background: linear-gradient(135deg, #ff6600 0%, #00aaff 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .form-container {
            max-width: 600px;
            width: 100%;
            background: white;
            padding: 35px 40px 40px 40px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border: 3px solid #00aaff;
            position: relative;
        }
        h2 {
            color: #ff6600;
            font-weight: 800;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
            letter-spacing: 1.2px;
        }
        label.form-label {
            font-weight: 600;
            color: #222222;
        }
        input.form-control, select.form-control, textarea.form-control {
            border: 2px solid #00aaff;
            transition: border-color 0.3s ease;
        }
        input.form-control:focus, select.form-control:focus, textarea.form-control:focus {
            border-color: #ff6600;
            box-shadow: 0 0 6px #ff6600aa;
            outline: none;
        }
        .btn-primary {
            background: linear-gradient(45deg, #00aaff, #0077cc);
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 170, 255, 0.6);
            transition: background 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #ff6600, #cc5200);
            box-shadow: 0 6px 20px rgba(255, 102, 0, 0.7);
        }
        .btn-secondary {
            background: #222222;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: background 0.3s ease;
            color: white;
        }
        .btn-secondary:hover {
            background: #555555;
            color: white;
        }
        .text-danger {
            font-size: 0.875rem;
            margin-top: 4px;
        }
    </style>
</head>
<body>
  <div class="container">
    <div class="col-lg-6 mx-auto">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="mb-3">Reprogramar cita</h4>

          <p class="text-muted">
            Cita actual: <strong>{{ cita.paciente }}</strong> con <strong>{{ cita.medico }}</strong>,
            el <strong>{{ cita.fecha }}</strong> a las <strong>{{ cita.hora }}</strong>.
          </p>

          <div class="alert alert-info">
            Límite de reprogramaciones: <strong>{{ max }}</strong> &nbsp; | &nbsp; Usadas: <strong>{{ usadas }}</strong>
          </div>

          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label">Fecha</label>
              {{ form.fecha }}
              {% if form.fecha.errors %}<div class="text-danger">{{ form.fecha.errors }}</div>{% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Hora</label>
              {{ form.hora }}
              {% if form.hora.errors %}<div class="text-danger">{{ form.hora.errors }}</div>{% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Médico</label>
              {{ form.medico }}
              {% if form.medico.errors %}<div class="text-danger">{{ form.medico.errors }}</div>{% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Motivo (opcional)</label>
              {{ form.motivo }}
            </div>

            {% if form.non_field_errors %}
              <div class="alert alert-danger">{{ form.non_field_errors }}</div>
            {% endif %}

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Guardar reprogramación</button>
              <a href="{% url 'home' %}" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Evitar fechas pasadas
    const fechaInput = document.getElementById("id_fecha");
    if (fechaInput) {
      const hoy = new Date();
      const yyyy = hoy.getFullYear();
      let mm = hoy.getMonth() + 1;
      let dd = hoy.getDate();
      if (dd < 10) dd = '0' + dd;
      if (mm < 10) mm = '0' + mm;
      fechaInput.setAttribute("min", `${yyyy}-${mm}-${dd}`);
    }
  </script>
</body>
</html>

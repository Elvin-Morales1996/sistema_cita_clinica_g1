{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BÃºsqueda de mÃ©dicos por especialidad</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{ --naranja:#ff6600; --celeste:#00aaff; --negro:#222; }
    body{
      background: linear-gradient(135deg, var(--naranja) 0%, var(--celeste) 100%);
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .box{ width:min(1100px,96vw); background:#fff; border-radius:16px; padding:30px;
      position:relative; box-shadow:0 10px 35px rgba(0,0,0,.18); border:3px solid var(--celeste); }
    .logo{ display:block; margin:0 auto 10px; max-width:120px; height:auto; border-radius:10px;
      border:3px solid var(--naranja); padding:6px; background:#fff; }
    h2{ text-align:center; color:var(--naranja); font-weight:800; margin-bottom:18px;
      text-shadow:1px 1px 3px rgba(0,0,0,.08); letter-spacing:1px; }
    label.form-label{ font-weight:600; color:var(--negro); }
    .form-control,.form-select{ border:2px solid var(--celeste); }
    .form-control:focus,.form-select:focus{ border-color:var(--naranja); box-shadow:0 0 6px #ff6600aa; outline:none; }
    .btn-primary{ background:linear-gradient(45deg, var(--celeste), #0077cc); border:none; font-weight:700; box-shadow:0 4px 14px rgba(0,170,255,.55); }
    .btn-primary:hover{ background:linear-gradient(45deg, var(--naranja), #cc5200); box-shadow:0 6px 20px rgba(255,102,0,.6); }
    .live-dot{ width:10px; height:10px; border-radius:50%; background:#bbb; display:inline-block; }
    .day-card{ border:2px solid #e9f6ff; border-radius:14px; padding:16px; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,.06); }
    .slot-pill{ display:inline-block; padding:.38rem .6rem; border-radius:999px; background:#e3f2fd; color:#0d47a1;
      font-weight:700; margin:.18rem; border:1px solid #bbdefb; font-size:.92rem; }
    .muted{ color:#666; }
  </style>
</head>
<body>
<div class="box">
  <h2>ğŸ” BÃºsqueda de mÃ©dicos por especialidad</h2>

  <form class="row g-2 mb-3" method="get">
  <div class="col-md-7">
    <input type="text" name="q" class="form-control"
           placeholder="Buscar por especialidad o nombreâ€¦"
           value="{{ q }}">
  </div>
  <div class="col-md-3">
    <select name="specialty" class="form-select" style="max-width:320px">
    <option value="">â€” Todas â€”</option>
    {% for esp in specialties %}
      <option value="{{ esp }}" {% if esp == selected_specialty %}selected{% endif %}>{{ esp }}</option>
    {% endfor %}
  </select>

  </div>
  <div class="col-md-2">
    <button class="btn btn-primary w-100">Buscar</button>
  </div>

</form>

{% if page_obj.object_list %}
  <ul class="list-group mb-3">
    {% for m in page_obj.object_list %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ m.nombre }}</strong><br>
          <small class="text-muted">Especialidad: {{ m.especialidad }}</small>
        </div>
        {# antes mandabas ...&fecha={{ today|date:'Y-m-d' }} pero 'today' no existÃ­a #}
    <a class="btn btn-primary btn-sm"
   href="{% url 'citas_disponibles' %}?specialty={{ medico.especialidad|urlencode }}&doctor={{ medico.id }}&fecha={{ today|date:'Y-m-d' }}&days=7">
  ğŸ—“ï¸ Ver disponibilidad
</a>

      </li>
    {% endfor %}
  </ul>

  <nav>
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?q={{ q|urlencode }}&scope={{ scope }}&page={{ page_obj.previous_page_number }}">Anterior</a>
        </li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">
        PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span></li>
      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?q={{ q|urlencode }}&scope={{ scope }}&page={{ page_obj.next_page_number }}">Siguiente</a>
        </li>
      {% endif %}
    </ul>
  </nav>
{% else %}
  <div class="alert alert-light border">
    {% if q %}
      No se encontraron mÃ©dicos para â€œ{{ q }}â€.
      <div class="small text-muted mt-1">
        Consejo: selecciona el alcance correcto (Especialidad / Nombre / Ambos).
      </div>
    {% else %}
      Empieza buscando por especialidad (p.ej. â€œPediatraâ€) o por nombre (p.ej. â€œErickâ€).
    {% endif %}
  </div>
{% endif %}


  {% if items %}
    <div class="list-group mb-3">
      {% for m in items %}
        <div class="list-group-item med-card">
          <div class="d-flex justify-content-between">
            <strong>{{ m.nombre }}</strong>
            <span class="badge text-bg-info">{{ m.especialidad }}</span>
          </div>
          <div class="small mt-1">{{ m.descripcion }}</div>
        </div>
      {% endfor %}
    </div>

    <!-- PaginaciÃ³n -->
    <nav aria-label="PaginaciÃ³n">
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?{% if selected_specialty %}specialty={{selected_specialty}}&{% endif %}{% if q %}q={{q}}&{% endif %}page={{ page_obj.previous_page_number }}">Â« Anterior</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Â« Anterior</span></li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?{% if selected_specialty %}specialty={{selected_specialty}}&{% endif %}{% if q %}q={{q}}&{% endif %}page={{ page_obj.next_page_number }}">Siguiente Â»</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Siguiente Â»</span></li>
        {% endif %}
      </ul>
    </nav>
  {% else %}
    <div class="alert alert-light border">No hay resultados con los filtros actuales.</div>
  {% endif %}

   <!-- BotÃ³n Volver al inicio (abajo, centrado) -->
    <div class="text-center my-4">
        <a href="{% url 'home' %}" class="btn btn-primary w-100 w-sm-auto " >ğŸ  Volver al inicio</a>
    </div>

</div>
</body>
</html>
